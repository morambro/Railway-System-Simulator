@(message: String,chatID:String)(implicit request: RequestHeader)

@main("WebSocket") {
    
    <div id="messages"> </div>
        
    <script type="text/javascript" charset="utf-8">
    
    	websocket = new WebSocket("@routes.Application.chat(chatID).webSocketURL()");
    	websocket.onopen = function(evt) {
    		write("OPEN")    		
    	};
    	websocket.onclose = function(evt) {
    		write("CLOSE")    		
    	};
    	
    	
    	websocket.onmessage = function(evt) { 
    		write('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
    		animate(0,0,2000);
    		animate(1,0,1000);
    	}
    	
    	
    	function sendMessage(msg) {
    		websocket.send(msg);
    	}
    	
    	function write(msg) {
    		var p = document.createElement("div");
    		p.innerHTML = msg;
    		document.getElementById("messages").appendChild(p);
    	}
    	
    	
    	
    </script>
    
    <textarea id="talk"></textarea>
    
    <script>
		var handleReturnKey = function(e) {
            if(e.charCode == 13 || e.keyCode == 13) {
                e.preventDefault()
                sendMessage($("#talk").val())
                $("#talk").val('')
            } 
        }
        
        $("#talk").keypress(handleReturnKey)  
	</script> 
	
	<div id="canvas"></div>
	<script>
		
		r = Animations.createRaphael(true,{
			container_id	: "canvas",
			width			: 400,
			height			: 500	
		});
		
		segments = new Array();
		
		segments[0] = Animations.createStraightPath(r,50,90,200,90);
        segments[1] = Animations.createStraightPath(r,230,90,300,200);
        
        
        stations = new Array();
   		stations[0] = r.circle(35,90,15);
   		stations[1] = r.circle(35+segments[0].getTotalLength()+30,90,15);
   
		trains = new Array();
		trains[0] = r.rect(0,0,25,15);trains[0].attr('fill',"red");
		trains[1] = r.rect(0,0,25,15);trains[1].attr('fill',"blue");
		
		//Animations.translate(rect,50,90);
		
		function animate(train, path, time) {
			Animations.runElementOnPath(trains[train],segments[path],time,0,1);
		}
		
	</script>
    
	<button onclick="animate(0,0,2000)"> animate </button>    
}

